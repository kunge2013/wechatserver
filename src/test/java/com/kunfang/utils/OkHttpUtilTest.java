package com.kunfang.utils;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONArray;
import com.alibaba.fastjson.JSONObject;
import com.kunfang.config.OkHttpConfig;
import okhttp3.OkHttpClient;
import org.junit.Test;

import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class OkHttpUtilTest {
    final Pattern HUOBI_DEPTH_PATTERN = Pattern.compile("market.(.*?).depth.step0");

    protected static String matchSymbol(String topic, Pattern pattern) {
        Matcher m = pattern.matcher(topic);
        while (m.find()) {
            return m.group(1);
        }
        return null;
    }
    @Test
    public void get() {
        OkHttpConfig config = new OkHttpConfig();
        OkHttpClient okHttpClient = new OkHttpClient();
        String url = "https://www.airbnb.cn/api/v2/explore_tabs?_format=for_explore_search_web&_intents=p1&auto_ib=true&checkin=2019-07-09&checkout=2019-07-10&client_session_id=c8dacee0-156f-44cc-ba43-5d5311d2767c&currency=CNY&experiences_per_grid=20&federated_search_session_id=725e6a5a-9706-4d14-a577-0ad3d76490c8&fetch_filters=true&from_prefetch=true&guidebooks_per_grid=20&has_zero_guest_treatment=true&host_promotion_type_ids%5B%5D=0&host_promotion_type_ids%5B%5D=1&host_promotion_type_ids%5B%5D=8&is_guided_search=true&is_new_cards_experiment=true&is_standard_search=true&items_offset=18&items_per_grid=18&key=d306zoyjsyarp7ifhu67rjxn52tv0t20&last_search_session_id=b05ca65f-df69-43ce-964e-827d93210055&locale=zh&luxury_pre_launch=false&map_toggle=true&metadata_only=false&query=%E6%AD%A6%E6%B1%89&query_understanding_enabled=true&refinement_paths%5B%5D=%2Fhomes&satori_version=1.1.3&screen_height=754&screen_size=large&screen_width=1536&section_offset=6&selected_tab_id=home_tab&show_groupings=true&supports_for_you_v3=true&timezone_offset=480&version=1.5.7,\n" +
                "https://www.airbnb.cn/api/v2/explore_tabs?_format=for_explore_search_web&_intents=p1&auto_ib=true&checkin=2019-07-09&checkout=2019-07-10&client_session_id=c8dacee0-156f-44cc-ba43-5d5311d2767c&currency=CNY&experiences_per_grid=20&federated_search_session_id=725e6a5a-9706-4d14-a577-0ad3d76490c8&fetch_filters=true&from_prefetch=true&guidebooks_per_grid=20&has_zero_guest_treatment=true&host_promotion_type_ids%5B%5D=0&host_promotion_type_ids%5B%5D=1&is_guided_search=true&is_new_cards_experiment=true&is_standard_search=true&items_offset=108&items_per_grid=18&key=d306zoyjsyarp7ifhu67rjxn52tv0t20&last_search_session_id=ccb4b92b-881f-47d4-812d-78d309c3e282&locale=zh&luxury_pre_launch=true&map_toggle=true&metadata_only=false&place_id=ChIJb_KF3fiuLjQRECJYbKzJwjk&query=%E6%AD%A6%E6%B1%89&query_understanding_enabled=true&refinement_paths%5B%5D=%2Fhomes&s_tag=Aex_rp25&satori_version=1.1.3&screen_height=754&screen_size=large&screen_width=1536&section_offset=6&selected_tab_id=home_tab&show_groupings=true&supports_for_you_v3=true&timezone_offset=480&version=1.5.7,\n" +
                "https://www.airbnb.cn/api/v2/explore_tabs?_format=for_explore_search_web&_intents=p1&auto_ib=true&checkin=2019-07-09&checkout=2019-07-10&client_session_id=c8dacee0-156f-44cc-ba43-5d5311d2767c&currency=CNY&experiences_per_grid=20&federated_search_session_id=725e6a5a-9706-4d14-a577-0ad3d76490c8&fetch_filters=true&from_prefetch=true&guidebooks_per_grid=20&has_zero_guest_treatment=true&host_promotion_type_ids%5B%5D=0&host_promotion_type_ids%5B%5D=1&is_guided_search=true&is_new_cards_experiment=true&is_standard_search=true&items_offset=126&items_per_grid=18&key=d306zoyjsyarp7ifhu67rjxn52tv0t20&last_search_session_id=04bb51a0-7ac9-487f-b878-3322ce526058&locale=zh&luxury_pre_launch=true&map_toggle=true&metadata_only=false&place_id=ChIJb_KF3fiuLjQRECJYbKzJwjk&query=%E6%AD%A6%E6%B1%89&query_understanding_enabled=true&refinement_paths%5B%5D=%2Fhomes&s_tag=Aex_rp25&satori_version=1.1.3&screen_height=754&screen_size=large&screen_width=1536&section_offset=6&selected_tab_id=home_tab&show_groupings=true&supports_for_you_v3=true&timezone_offset=480&version=1.5.7,\n" +
                "https://www.airbnb.cn/api/v2/explore_tabs?_format=for_explore_search_web&_intents=p1&auto_ib=true&checkin=2019-07-09&checkout=2019-07-10&client_session_id=c8dacee0-156f-44cc-ba43-5d5311d2767c&currency=CNY&experiences_per_grid=20&federated_search_session_id=725e6a5a-9706-4d14-a577-0ad3d76490c8&fetch_filters=true&from_prefetch=true&guidebooks_per_grid=20&has_zero_guest_treatment=true&host_promotion_type_ids%5B%5D=0&host_promotion_type_ids%5B%5D=1&is_guided_search=true&is_new_cards_experiment=true&is_standard_search=true&items_offset=144&items_per_grid=18&key=d306zoyjsyarp7ifhu67rjxn52tv0t20&last_search_session_id=6faec3d9-93f4-4743-9453-3ca8b31a9f03&locale=zh&luxury_pre_launch=true&map_toggle=true&metadata_only=false&place_id=ChIJb_KF3fiuLjQRECJYbKzJwjk&query=%E6%AD%A6%E6%B1%89&query_understanding_enabled=true&refinement_paths%5B%5D=%2Fhomes&s_tag=Aex_rp25&satori_version=1.1.3&screen_height=754&screen_size=large&screen_width=1536&section_offset=6&selected_tab_id=home_tab&show_groupings=true&supports_for_you_v3=true&timezone_offset=480&version=1.5.7,\n" +
                "https://www.airbnb.cn/api/v2/explore_tabs?_format=for_explore_search_web&_intents=p1&auto_ib=true&checkin=2019-07-09&checkout=2019-07-10&client_session_id=c8dacee0-156f-44cc-ba43-5d5311d2767c&currency=CNY&experiences_per_grid=20&federated_search_session_id=725e6a5a-9706-4d14-a577-0ad3d76490c8&fetch_filters=true&from_prefetch=true&guidebooks_per_grid=20&has_zero_guest_treatment=true&host_promotion_type_ids%5B%5D=0&host_promotion_type_ids%5B%5D=1&is_guided_search=true&is_new_cards_experiment=true&is_standard_search=true&items_offset=198&items_per_grid=18&key=d306zoyjsyarp7ifhu67rjxn52tv0t20&last_search_session_id=f873098a-832d-43a5-af82-871a4f17bee4&locale=zh&luxury_pre_launch=true&map_toggle=true&metadata_only=false&place_id=ChIJb_KF3fiuLjQRECJYbKzJwjk&query=%E6%AD%A6%E6%B1%89&query_understanding_enabled=true&refinement_paths%5B%5D=%2Fhomes&s_tag=Aex_rp25&satori_version=1.1.3&screen_height=754&screen_size=large&screen_width=1536&section_offset=6&selected_tab_id=home_tab&show_groupings=true&supports_for_you_v3=true&timezone_offset=480&version=1.5.7,\n" +
                "https://www.airbnb.cn/api/v2/explore_tabs?_format=for_explore_search_web&_intents=p1&auto_ib=true&checkin=2019-07-09&checkout=2019-07-10&client_session_id=c8dacee0-156f-44cc-ba43-5d5311d2767c&currency=CNY&experiences_per_grid=20&federated_search_session_id=725e6a5a-9706-4d14-a577-0ad3d76490c8&fetch_filters=true&from_prefetch=true&guidebooks_per_grid=20&has_zero_guest_treatment=true&host_promotion_type_ids%5B%5D=0&host_promotion_type_ids%5B%5D=1&is_guided_search=true&is_new_cards_experiment=true&is_standard_search=true&items_offset=90&items_per_grid=18&key=d306zoyjsyarp7ifhu67rjxn52tv0t20&last_search_session_id=65be59cf-4ef5-4677-9ce5-85450efc0f73&locale=zh&luxury_pre_launch=true&map_toggle=true&metadata_only=false&place_id=ChIJb_KF3fiuLjQRECJYbKzJwjk&query=%E6%AD%A6%E6%B1%89&query_understanding_enabled=true&refinement_paths%5B%5D=%2Fhomes&s_tag=Aex_rp25&satori_version=1.1.3&screen_height=754&screen_size=large&screen_width=1536&section_offset=6&selected_tab_id=home_tab&show_groupings=true&supports_for_you_v3=true&timezone_offset=480&version=1.5.7,\n" +
                "https://www.airbnb.cn/api/v2/explore_tabs?_format=for_explore_search_web&_intents=p1&auto_ib=true&checkin=2019-07-09&checkout=2019-07-10&client_session_id=c8dacee0-156f-44cc-ba43-5d5311d2767c&currency=CNY&experiences_per_grid=20&federated_search_session_id=725e6a5a-9706-4d14-a577-0ad3d76490c8&fetch_filters=true&guidebooks_per_grid=20&has_zero_guest_treatment=true&host_promotion_type_ids%5B%5D=0&host_promotion_type_ids%5B%5D=1&is_guided_search=true&is_new_cards_experiment=true&is_standard_search=true&items_offset=162&items_per_grid=18&key=d306zoyjsyarp7ifhu67rjxn52tv0t20&last_search_session_id=5a09a0ee-a689-4452-87d6-ea0aee1eecd6&locale=zh&luxury_pre_launch=true&map_toggle=true&metadata_only=false&place_id=ChIJb_KF3fiuLjQRECJYbKzJwjk&query=%E6%AD%A6%E6%B1%89&query_understanding_enabled=true&refinement_paths%5B%5D=%2Fhomes&s_tag=Aex_rp25&satori_version=1.1.3&screen_height=754&screen_size=large&screen_width=1536&section_offset=6&selected_tab_id=home_tab&show_groupings=true&supports_for_you_v3=true&timezone_offset=480&version=1.5.7,\n" +
                "https://www.airbnb.cn/api/v2/explore_tabs?_format=for_explore_search_web&_intents=p1&auto_ib=true&checkin=2019-07-09&checkout=2019-07-10&client_session_id=c8dacee0-156f-44cc-ba43-5d5311d2767c&currency=CNY&experiences_per_grid=20&federated_search_session_id=725e6a5a-9706-4d14-a577-0ad3d76490c8&fetch_filters=true&guidebooks_per_grid=20&has_zero_guest_treatment=true&host_promotion_type_ids%5B%5D=0&host_promotion_type_ids%5B%5D=1&is_guided_search=true&is_new_cards_experiment=true&is_standard_search=true&items_offset=180&items_per_grid=18&key=d306zoyjsyarp7ifhu67rjxn52tv0t20&last_search_session_id=a84c82c2-8146-45af-b424-3527c039e1e4&locale=zh&luxury_pre_launch=true&map_toggle=true&metadata_only=false&place_id=ChIJb_KF3fiuLjQRECJYbKzJwjk&query=%E6%AD%A6%E6%B1%89&query_understanding_enabled=true&refinement_paths%5B%5D=%2Fhomes&s_tag=Aex_rp25&satori_version=1.1.3&screen_height=754&screen_size=large&screen_width=1536&section_offset=6&selected_tab_id=home_tab&show_groupings=true&supports_for_you_v3=true&timezone_offset=480&version=1.5.7,\n" +
                "https://www.airbnb.cn/api/v2/explore_tabs?_format=for_explore_search_web&_intents=p1&auto_ib=true&checkin=2019-07-09&checkout=2019-07-10&client_session_id=c8dacee0-156f-44cc-ba43-5d5311d2767c&currency=CNY&experiences_per_grid=20&federated_search_session_id=725e6a5a-9706-4d14-a577-0ad3d76490c8&fetch_filters=true&guidebooks_per_grid=20&has_zero_guest_treatment=true&host_promotion_type_ids%5B%5D=0&host_promotion_type_ids%5B%5D=1&is_guided_search=true&is_new_cards_experiment=true&is_standard_search=true&items_offset=216&items_per_grid=18&key=d306zoyjsyarp7ifhu67rjxn52tv0t20&last_search_session_id=63f9f5ed-2192-450b-8fdb-8c4ffa5d3f14&locale=zh&luxury_pre_launch=true&map_toggle=true&metadata_only=false&place_id=ChIJb_KF3fiuLjQRECJYbKzJwjk&query=%E6%AD%A6%E6%B1%89&query_understanding_enabled=true&refinement_paths%5B%5D=%2Fhomes&s_tag=Aex_rp25&satori_version=1.1.3&screen_height=754&screen_size=large&screen_width=1536&section_offset=6&selected_tab_id=home_tab&show_groupings=true&supports_for_you_v3=true&timezone_offset=480&version=1.5.7,\n" +
                "https://www.airbnb.cn/api/v2/explore_tabs?_format=for_explore_search_web&_intents=p1&auto_ib=true&checkin=2019-07-09&checkout=2019-07-10&client_session_id=c8dacee0-156f-44cc-ba43-5d5311d2767c&currency=CNY&experiences_per_grid=20&federated_search_session_id=725e6a5a-9706-4d14-a577-0ad3d76490c8&fetch_filters=true&guidebooks_per_grid=20&has_zero_guest_treatment=true&host_promotion_type_ids%5B%5D=0&host_promotion_type_ids%5B%5D=1&is_guided_search=true&is_new_cards_experiment=true&is_standard_search=true&items_offset=234&items_per_grid=18&key=d306zoyjsyarp7ifhu67rjxn52tv0t20&last_search_session_id=50401e97-ba91-4de7-90c4-a7832597a177&locale=zh&luxury_pre_launch=true&map_toggle=true&metadata_only=false&place_id=ChIJb_KF3fiuLjQRECJYbKzJwjk&query=%E6%AD%A6%E6%B1%89&query_understanding_enabled=true&refinement_paths%5B%5D=%2Fhomes&s_tag=Aex_rp25&satori_version=1.1.3&screen_height=754&screen_size=large&screen_width=1536&section_offset=6&selected_tab_id=home_tab&show_groupings=true&supports_for_you_v3=true&timezone_offset=480&version=1.5.7,\n" +
                "https://www.airbnb.cn/api/v2/explore_tabs?_format=for_explore_search_web&_intents=p1&auto_ib=true&checkin=2019-07-09&checkout=2019-07-10&client_session_id=c8dacee0-156f-44cc-ba43-5d5311d2767c&currency=CNY&experiences_per_grid=20&federated_search_session_id=725e6a5a-9706-4d14-a577-0ad3d76490c8&fetch_filters=true&guidebooks_per_grid=20&has_zero_guest_treatment=true&host_promotion_type_ids%5B%5D=0&host_promotion_type_ids%5B%5D=1&is_guided_search=true&is_new_cards_experiment=true&is_standard_search=true&items_offset=36&items_per_grid=18&key=d306zoyjsyarp7ifhu67rjxn52tv0t20&last_search_session_id=ee8a82f5-feba-48df-b4f7-f4850e0246d2&locale=zh&luxury_pre_launch=true&map_toggle=true&metadata_only=false&place_id=ChIJb_KF3fiuLjQRECJYbKzJwjk&query=%E6%AD%A6%E6%B1%89&query_understanding_enabled=true&refinement_paths%5B%5D=%2Fhomes&s_tag=Aex_rp25&satori_version=1.1.3&screen_height=754&screen_size=large&screen_width=1536&section_offset=6&selected_tab_id=home_tab&show_groupings=true&supports_for_you_v3=true&timezone_offset=480&version=1.5.7,\n" +
                "https://www.airbnb.cn/api/v2/explore_tabs?_format=for_explore_search_web&_intents=p1&auto_ib=true&checkin=2019-07-09&checkout=2019-07-10&client_session_id=c8dacee0-156f-44cc-ba43-5d5311d2767c&currency=CNY&experiences_per_grid=20&federated_search_session_id=725e6a5a-9706-4d14-a577-0ad3d76490c8&fetch_filters=true&guidebooks_per_grid=20&has_zero_guest_treatment=true&host_promotion_type_ids%5B%5D=0&host_promotion_type_ids%5B%5D=1&is_guided_search=true&is_new_cards_experiment=true&is_standard_search=true&items_offset=54&items_per_grid=18&key=d306zoyjsyarp7ifhu67rjxn52tv0t20&last_search_session_id=71a64096-0fbb-4bc2-ad1c-2c00fa210b4d&locale=zh&luxury_pre_launch=true&map_toggle=true&metadata_only=false&place_id=ChIJb_KF3fiuLjQRECJYbKzJwjk&query=%E6%AD%A6%E6%B1%89&query_understanding_enabled=true&refinement_paths%5B%5D=%2Fhomes&s_tag=Aex_rp25&satori_version=1.1.3&screen_height=754&screen_size=large&screen_width=1536&section_offset=6&selected_tab_id=home_tab&show_groupings=true&supports_for_you_v3=true&timezone_offset=480&version=1.5.7,\n" +
                "https://www.airbnb.cn/api/v2/explore_tabs?_format=for_explore_search_web&_intents=p1&auto_ib=true&checkin=2019-07-09&checkout=2019-07-10&client_session_id=c8dacee0-156f-44cc-ba43-5d5311d2767c&currency=CNY&experiences_per_grid=20&federated_search_session_id=725e6a5a-9706-4d14-a577-0ad3d76490c8&fetch_filters=true&guidebooks_per_grid=20&has_zero_guest_treatment=true&host_promotion_type_ids%5B%5D=0&host_promotion_type_ids%5B%5D=1&is_guided_search=true&is_new_cards_experiment=true&is_standard_search=true&items_offset=72&items_per_grid=18&key=d306zoyjsyarp7ifhu67rjxn52tv0t20&last_search_session_id=2df56df9-7b52-48c4-a2e5-05276fbc0704&locale=zh&luxury_pre_launch=true&map_toggle=true&metadata_only=false&place_id=ChIJb_KF3fiuLjQRECJYbKzJwjk&query=%E6%AD%A6%E6%B1%89&query_understanding_enabled=true&refinement_paths%5B%5D=%2Fhomes&s_tag=Aex_rp25&satori_version=1.1.3&screen_height=754&screen_size=large&screen_width=1536&section_offset=6&selected_tab_id=home_tab&show_groupings=true&supports_for_you_v3=true&timezone_offset=480&version=1.5.7";
         String[] urls =  url.split(",\n");
        for(int tt = 0 ;tt < urls.length;tt ++) {
            String uri = urls[tt];
            String data = OkHttpUtil.get(uri, null,okHttpClient);
            JSONObject jsondata =  JSON.parseObject(data);
            JSONArray dataArray =  jsondata.getJSONArray("explore_tabs");
            for(int index = 0; index < dataArray.size(); index++) {
                JSONObject obj = dataArray.getJSONObject(index);
                JSONArray sectionsArray =  obj.getJSONArray("sections");
                for (int i = 0; i < sectionsArray.size();i++) {
                    JSONObject dataObj =  sectionsArray.getJSONObject(i);
                    JSONArray listings = dataObj.getJSONArray("listings");
                    for (int j = 0 ; j < listings.size() ;j++) {
                        JSONObject jsonObject =  listings.getJSONObject(j);
                        JSONObject listObj = jsonObject.getJSONObject("listing");
                        String localized_city = listObj.getString("localized_city");
                        String name = listObj.getString("name");
                       String names [] =  name.split("ã€‘");
                       String hotileName = null;
                       if (names.length == 2) {
                           hotileName = names[0];
                           System.out.println(localized_city + " ," + hotileName+" ," + names[1]);
                       }
                    }
                }
            }
        }


    }
}